<%= javascript_tag do %>

    var button = document.createElement("Button");
    var title = document.createElement("H1");
    var title_name = document.createTextNode("The red box.");
    //var points_counter = document.createElement("div")
    var button_name = document.createTextNode("Start");
    var red_box = document.createElement("div");
    var game_container = document.createElement("div");
    var win_box = document.createElement("div");
    var loose_box = document.createElement("div");
    
    title.appendChild(title_name);
    button.appendChild(button_name);
    title.appendChild(button);
    
    
    //Appending classes and id's to created elements; this is to be able to style and manipulate them.
    button.setAttribute("class", "btn btn-sm btn-success");
    button.setAttribute("id", "startbutton");
    title.setAttribute("class", "turn_red well col-md-6 col-md-offset-3", "id", "title");
    title.setAttribute("id", "title");
    red_box.setAttribute("class", "redbox");
    game_container.setAttribute("class", "gamecontainer");
    win_box.setAttribute("class", "winbox");
    loose_box.setAttribute("class", "loosebox");
    //points_counter.setAttribute("class", "well");
    
    
    //background color
    document.body.style.backgroundColor = "blue";
    
    //placing elements on screen
    document.body.appendChild(title);
    document.body.appendChild(game_container);
    document.body.appendChild(win_box);
    document.body.appendChild(loose_box);
    //appended redbox last to make sure it is placed on top.
    document.body.appendChild(red_box);
    //document.body.appendChild("points_counter");

    //start game button event listener
    button.addEventListener("click", showGame);
    
    
    //General functions
    function arrayIt(array){
        array = array.split(' ');
        console.log(array);
    };
    function getRandomInt(min, max){
       return Math.floor((Math.random() * (max - min + 1) + min));
    };
    function getRandom10(min, max){
        return getRandomInt(min / 10, max / 10) * 10
    };
    function compareValue(x, y){
        return x == y;
    }
    //visual setup functions
    
    
    //define the wall space
    var wall_top = "";
    var wall_left = "";
    //setup walltop and wallleft arrays
    var wall_top_array = [];
    var wall_left_array = [];
    
    //setup walls on screen
     for(i = 0; i < 50; i++){
       //make a wall and give it wallbox class
       var wall_box = document.createElement("div");
       wall_box.setAttribute("class", "wallbox");
       
       //appends each wall box to the screen
       document.body.appendChild(wall_box);
       wall_box.style.display = "none";
       
       //pick a random spot for each wall(two walls could be placed on same spot)
       randomTop = getRandom10(300, 540);
       randomLeft = getRandom10(500, 740);
       
       //logs the place of each box and puts it in an array
       wall_top = randomTop;
       wall_top_array.push(wall_top);
       wall_left = randomLeft
       wall_left_array.push(wall_left);
       
       //finish up by setting up each wall box's style
       wall_box.style.top = randomTop + "px";
       wall_box.style.left = randomLeft + "px";
    }
    
    
   
   //pick a random number for loose box top and left
   var randomTop = getRandom10(300, 540);
   var randomLeft = getRandom10(500, 740);
     

    

   //document.body.style.display = "none";
   red_box.style.display = "none";
   game_container.style.display = "none";
   win_box.style.display = "none";
   loose_box.style.display = "none";
   loose_box.style.top = randomTop + "px";
   loose_box.style.left = randomLeft + "px";
   
   
   //Intro
   $(document).ready(function(){
   $("#title").fadeIn(2000).slow();
   });
   
   //When pressing start button fade in game
   function showGame(){
       $("#startbutton").fadeOut(2000);
       $(".redbox").fadeIn(2000);
       $(".gamecontainer").fadeIn(2000);
       $(".winbox").fadeIn(2000);
       $(".loosebox").fadeIn(2000);
       //for(i = 0; i < 50; i++){
       $(".wallbox").fadeIn(2000);
       //}
       setInterval(moveLooseBox, 50);
       setInterval(evaluateLoose, 10);
       setInterval(wallHit, 5);
       setInterval(shiftLooseBox, 2500);
       setInterval(moveRedbox, 10);
   }
   
   //x axis
   var square_x = 500;
   //y axis
   var square_y = 300;
   //top of loose box
   var loose_top = randomTop
   //left of loose box
   var loose_left = randomLeft
   //value to shift directions of loose box
   var loose_direction = 0;
   //counter for levels
   var points_counter = 0;
   //register a game over
   var game_over = 0;
   //register a left key being pressed
   var left_key = 0;
   //register an up key being pressed
   var up_key = 0;
   //register a down key being pressed
   var down_key = 0;
//key logger
document.body.onkeydown = function(e){
   press = e || window.event
       //d key
   if(game_over == 0){
       if(press.keyCode === 68){
           if(square_x < 740){
               square_x += 10
               red_box.style.left = square_x.toString() + "px";
               console.log(square_x);
               evaluateWin();
               left_key = 0;
               up_key = 0;
               down_key = 0;
               //console.log(loose_box.style.top);
               if(hit == 1){
                   square_x -= 20
                   hit = 0;
               }
           }
       }
       //a key
       if(press.keyCode == 65){
           if(square_x > 500){
               square_x -= 10
               red_box.style.left = square_x.toString() + "px";
               console.log(square_x);
               evaluateWin();
               left_key = 1;
               up_key = 0;
               down_key = 0;
               if(hit == 1){
                   square_x += 20
                   hit = 0;
               }
           };
       }
       //w key
       if(press.keyCode == 87){
           if(square_y > 300){
               square_y -= 10
               red_box.style.top = square_y.toString() + "px";
               console.log(square_y);
               evaluateWin();
               left_key = 0;
               up_key = 1;
               down_key = 0;
               console.log("HELLO");
               if(hit == 1){
                   square_y += 20
                   hit = 0;
               }
           }
       }
       //s key
       if(press.keyCode == 83){
           if(square_y < 540){
               square_y += 10
               red_box.style.top = square_y.toString() + "px";
               console.log(square_y);
               evaluateWin();
               left_key = 0;
               up_key = 0;
               down_key = 1;
               if(hit == 1){
                   square_y -= 20
                   hit = 0;
               }
           }
       }
   }
};
//game functions
// quick redbox positioning if hitting a wall
function moveRedbox(){
    if(hit == 1 && left_key == 0 && up_key == 0 && down_key == 0){
    //red_box.style.top = 300 + "px";
    //red_box.style.left = 500 + "px";
    //square_x = 500;
    //square_y = 300;
    square_x -= 10;
    red_box.style.left = square_x.toString() + "px";
    red_box.style.top = square_y.toString() + "px";
    console.log("hi");
    hit = 0;
    }
    if(left_key == 1  && hit == 1){
        square_x += 20;
        left_key = 0;
        console.log("left");
    }
    if(up_key == 1  && hit == 1){
        square_y += 10;
        square_x += 10;
        up_key = 0;
        console.log("up");
    }
    if(down_key == 1  && hit == 1){
        square_y -= 10;
        square_x += 10;
        down_key = 0;
        console.log("down");
    }
}
//move loose box left and right
function shiftLooseBox(){
    randomLeft = getRandom10(500, 740);
    loose_box.style.left = randomLeft + "px";
    loose_left = randomLeft
}
//Move loose box up and down
function moveLooseBox(){
    if(loose_direction == 0){
        randomTop -= 10;
        loose_box.style.top = randomTop + "px";
        loose_top = randomTop
        if(randomTop <= 300){
            loose_direction = 1;
        }
    }
    else if(loose_direction == 1){
        randomTop += 10;
        loose_box.style.top = randomTop + "px";
        loose_top = randomTop
        if(randomTop >= 540){
            loose_direction = 0;
        }
    }
    
    
}
var left_array;
var top_array;
//log a hit
var hit = 0;
function wallHit(){
    
    for(i = 0; i < 50; i++){
    left_array = wall_left_array[i]
    top_array = wall_top_array[i]
    //console.log(top_array);
    //console.log(left_array);
        if(compareValue(square_x, left_array) && compareValue(square_y, top_array)){
        console.log("hit");
        hit = 1;
        }
    }
}
function evaluateWin(){
    if(square_x == 740 && square_y == 540 || square_x == 740 && square_y == 530){
    console.log("Winner!");
    title.innerHTML = "You win!";
    title.style.backgroundColor = "green";
    $(".redbox").fadeOut(2000);
    $(".gamecontainer").fadeOut(2000);
    $(".winbox").fadeOut(2000);
    $(".loosebox").fadeOut(2000);
    $(".wallbox").fadeOut(2000);
    red_box.style.top = 300 + "px";
    red_box.style.left = 500 + "px";
    square_x = 500;
    square_y = 300;
    points_counter += 1;
    alert("Level " + points_counter);
    showGame();
    }
}
function evaluateLoose(){
    if(square_y == loose_top && square_x == loose_left){
    console.log("You loose!");
    title.innerHTML = "You Loose!";
    title.style.backgroundColor = "maroon";
    alert("Game Over")
    $(".redbox").fadeOut(2000);
    $(".gamecontainer").fadeOut(2000);
    $(".winbox").fadeOut(2000);
    $(".loosebox").fadeOut(2000);
    $(".wallbox").fadeOut(2000);
    square_x = 400;
    square_y = 200;
    game_over = 1;
    hit = 0;
    }
}
   
    
<% end %>
